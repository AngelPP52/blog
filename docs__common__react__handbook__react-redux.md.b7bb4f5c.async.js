(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[29],{pNpl:function(e,t,n){"use strict";n.r(t);var a=n("ahKI"),r=n.n(a),c=n("s8Wh"),o=n("Fesk"),s=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h1",{id:"redux"},r.a.createElement(c["AnchorLink"],{to:"#redux","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Redux"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"store \u5185\u90e8\u4fdd\u5b58\u4e86\u4e00\u68f5\u72b6\u6001\u6811"),r.a.createElement("p",null,"\u7ec4\u4ef6\u901a\u8fc7 dispatch \u6d3e\u53d1 action \u884c\u4e3a\u7ed9 store\uff0c\u901a\u8fc7\u8ba2\u9605 store \u4e2d\u7684 state \u6765\u66f4\u65b0\u89c6\u56fe")),r.a.createElement("p",null,r.a.createElement("img",{src:n("zH6c"),alt:""})),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u4e00\u4e2a\u5e94\u7528\u53ea\u6709\u4e00\u4e2a store\uff0c\u53ea\u6709\u4e00\u68f5\u72b6\u6001\u6811"),r.a.createElement("p",null,"\u72b6\u6001\u662f\u53ea\u8bfb\u7684\uff0c\u53ea\u80fd\u901a\u8fc7 state \u6765\u6539\u53d8"),r.a.createElement("p",null,"\u5355\u4e00\u6570\u636e\u6e90")),r.a.createElement("h2",{id:"reducer"},r.a.createElement(c["AnchorLink"],{to:"#reducer","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"reducer"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u4e00\u4e2a\u51fd\u6570\uff0c\u63a5\u6536\u4e00\u4e2a\u8001\u7684 state \u548c\u4e00\u4e2a action\uff0c\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 state")),r.a.createElement("h2",{id:"createstore"},r.a.createElement(c["AnchorLink"],{to:"#createstore","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"createStore"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u521b\u5efa\u4e00\u4e2a store\uff0c\u4f20\u5165\u4e00\u4e2a reducer \u548c\u4e00\u4e2a\u521d\u59cb state\uff0c\u8fd4\u56de\u4e00\u4e2a store \u5bf9\u8c61\uff08dispatch\uff0csubscribe\uff0cgetState\uff09"),r.a.createElement("p",null,"\u57fa\u4e8e\u53d1\u5e03\u8ba2\u9605\uff0c\u53d1\u5e03\uff08dispatch\uff09\u548c\u8ba2\u9605\uff08subscribe\uff09")),r.a.createElement(o["a"],{code:"function createStore(reducer, preloadedState){\n    let currentReducer = reducer;\n    let currentState = preloadedState;\n    let currentListeners = [];\n    \n    function getState(){\n        return currentState;\n    }\n    \n    function subscribe(listener){ // \u9875\u9762\u8ba2\u9605\n        currentLiseners.push(listener);\n        \n        return function unsubscribe(){\n            currentListeners = currentListeners.filter(l=> l!== listener);\n        }\n    }\n    \n    function dispatch(action){ // \u6d3e\u53d1 action \u65f6\uff0c\u8c03\u7528 reducer \u66f4\u65b0\u72b6\u6001\uff0c\u89e6\u53d1\u6240\u6709\u8ba2\u9605\u56de\u8c03\uff0c\u66f4\u65b0\u9875\u9762\n        currentState = currentReducer(currentState, action);\n        // \u89e6\u53d1\u6240\u6709\u7684 listener\n        for(let i = 0; i < currentListeners.length; i++){\n            currentListeners[i]();\n        }\n        return action;\n    }\n    \n    dispatch({type: '@@INIT'}); // redux \u5185\u90e8\u5148\u81ea\u5df1\u6d3e\u53d1\u4e00\u6b21\u521d\u59cb\u5316 state\n    const store = {\n        dispatch,\n        subscribe,\n        getState\n    }\n    \n    return store;\n}",lang:"js"}),r.a.createElement("h2",{id:"bindactioncreators"},r.a.createElement(c["AnchorLink"],{to:"#bindactioncreators","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"bindActionCreators"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u521b\u5efa\u4e00\u4e2a\u5de5\u5382\u5b9e\u4f8b\uff0c\u76f4\u63a5\u8c03\u7528\u91cc\u9762\u7684\u65b9\u6cd5\u5373\u53ef\u8fdb\u884c\u6d3e\u53d1\u3002",r.a.createElement("strong",null,"\u907f\u514d\u91cd\u590d\u5199",r.a.createElement("code",null,"store.dispatch(actions)"),"\u8fd9\u6837\u7684\u4ee3\u7801")),r.a.createElement("p",null,"props.add() ===> add()","{","store.dispatch(\u2018add\u2019)","}")),r.a.createElement(o["a"],{code:"// \u4f8b\u5982\nconst actions = {\n    add(){\n\t\treturn {type: 'add'}\n    },\n    minus(){\n        return {type: 'minus'}\n    }\n}\n\n// \u4f20\u5165\u5355\u4e2a action\uff08function \u5f62\u5f0f\uff09\uff0c\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u51fd\u6570\uff08\u88ab\u8c03\u7528\u65f6\uff0c\u4f1a\u89e6\u53d1 dispatch\uff09\nfunction bindActionCreator(actionCreator, dispatch){\n    return function (...args){\n        // \u8c03\u7528 action.add \u8fd4\u56de{type: 'add'}\uff0c\u8c03\u7528 dispatch({type: 'add'})\n        return dispatch(actionCreator.apply(this, args)); \n    }\n}\n// 1. \u4f20\u5165\u5355\u4e2a action\uff0c\u8fd4\u56de bindActionCreator(...)\n// 2. \u4f20\u5165\u4e00\u4e2a\u5bf9\u8c61\uff0c\u91cc\u9762\u5b9a\u4e86\u4e00\u4e2a\u5f88\u591a action\uff08function \u5f62\u5f0f\uff09\uff0c\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\uff0c\u91cc\u9762\u5305\u542b\u4e86\u6240\u6709 key \u5bf9\u5e94\u7684\u65b0\u7684\u51fd\u6570\uff08\u88ab\u8c03\u7528\u65f6\uff0c\u4f1a\u89e6\u53d1 dispatch\uff09\nfunction bindActionCreator(actionCreators, dispacth){\n    if(typeof actionCreators === 'function'){\n        return bindActionCreator(actionCreators, dispacth);\n    }\n    const boundActionCreators = {}; // \u7528\u6765\u5b58\u50a8\u8fd4\u56de\u7684\n    for(const key in actionCreators){\n        if(typeof actionCreators[key] === 'function'){\n        \tconst actionCreator = bindActionCreator(actionCreators[key], dispacth);\n            boundActionCreators[key] = actionCreator;\n        }\n    }\n    return boundActionCreators;\n}",lang:"js"}),r.a.createElement("h2",{id:"combinereducers"},r.a.createElement(c["AnchorLink"],{to:"#combinereducers","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"combineReducers"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u5408\u5e76 reducers\uff08\u5bf9\u8c61\u5f62\u5f0f","{"," Counter1, Counter2 ","}","\uff09\uff0c\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684 reducer")),r.a.createElement(o["a"],{code:"// \u4f8b\u5982\nconst reducers = {\n    counter1, // (state, action) => {}\n    counter2,\n    // ...\n}\n\nfunction combineReducers(reducers){\n    const reducerKeys = Object.keys(reducers);\n    const finalReducers = {}; // \u7528\u6765\u8fc7\u6ee4\u4e00\u4e9b\u4e0d\u5408\u89c4\u8303\u7684 reducer\n    for(const i = 0; i < reducerKeys.length; i++){\n        const key = reducersKeys[i];\n        if(typeof reducers[key] === 'function'){\n            finalReducers[key] = reducers[key];\n        }\n    }\n    \n    const finalReducerKeys = Object.key(finalReducers);\n    // \u8fd9\u662f\u4e00\u4e2a\u65b0\u7684 reducer\n    // dispatch \u7684\u65f6\u5019\u4f1a\u88ab\u89e6\u53d1\uff0c\u603b\u7684 reducer\uff0c\u5728\u91cc\u9762\u904d\u5386\u6240\u6709\u7684 reducer\uff0c\u4f20\u5165\u8001\u7684 state \u548c action\uff0c\u5224\u65ad state \u662f\u5426\u6539\u53d8\u3002\u6700\u540e\u8fd4\u56de\u603b\u7684 state\n    return function combination(state = {}, action){ \n        let hashChanged = false;\n        const nextState = {};\n        // \u8c03\u7528\u6bcf\u4e00\u4e2a reducer\uff0c\u8ba1\u7b97\u6700\u65b0\u7684 state\uff1anextState\n        for(const i = 0; i < finalReducerKeys.length; i++){\n\t        const ket = finalReducerKeys[i];\n            const reducer = finalReducers[key];\n            const prevStateForKey = state[key]; // \u6839\u636e key \u83b7\u53d6\u8001\u7684 state\n            const nexStateForKey = reducer(prevStateForKey, reducer);\n            nestState[key] = nextStateForKey;\n            hasChanged = hasChanged || nextStateForKey !== prevStateForKey;\n    \t}\n        hasChanged = hasChanged || finalReducerKeys.length !== Object.keys(state).length;\n        return hasChanged ? nextState : state; // \u5176\u4e2d\u4e00\u4e2a state \u6539\u53d8\uff0c\u5176\u4ed6 state \u7684\u5173\u8054\u9875\u9762\u90fd\u4f1a\u91cd\u65b0 render\uff08\u6267\u884c\u7ec4\u4ef6\uff09\n    }\n}",lang:"js"}),r.a.createElement("h2",{id:"react-redux"},r.a.createElement(c["AnchorLink"],{to:"#react-redux","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"react-redux"),r.a.createElement("blockquote",null,r.a.createElement("p",null,r.a.createElement("strong",null,"\u89e3\u51b3\u5f15\u5165 store\uff0c\u8ba2\u9605 state\uff0c\u53d6\u6d88\u8ba2\u9605 state\uff0c\u8c03\u7528 getState \u7b49\u91cd\u590d\u903b\u8f91")),r.a.createElement("p",null,"\u7528\u6cd5\uff1a"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u4ece react-redux \u5f15\u5165",r.a.createElement("code",null,"connect")),r.a.createElement("li",null,"\u8c03\u7528 connect\uff08\u67ef\u91cc\u5316\u51fd\u6570\uff09\uff0c\u7b2c\u4e00\u6b21\u4f20\u5165",r.a.createElement("code",null,"\uff08mapStateProps, [mapDispatchProps \u6216 actions]\uff09"),"\uff0c\u7b2c\u4e8c\u6b21\u4f20\u5165\u7ec4\u4ef6"),r.a.createElement("li",null,r.a.createElement("code",null,"mapStateProps = (state) => state.counter1"),"; // \u4f20\u5165\u603b\u7684 state\uff0c\u8fd4\u56de\u5b50\u7684 state"),r.a.createElement("li",null,r.a.createElement("code",null,"mapDispatchProps = (dispatch) => (","{"," add()","{"," dispatch(","{","type: 'ADD' ","}",")","}"," ","}",")"),"; // \u4f20\u5165 dispatch\uff0c\u8fd4\u56de\u4e00\u4e2a\u65b0\u7684\u5bf9\u8c61\uff08\u91cc\u9762\u542b\u4e86\u7ec4\u4ef6\u9700\u8981\u6d3e\u9001 action \u7684\u65b9\u6cd5\uff09"),r.a.createElement("li",null,"\u4ece react-redux \u5f15\u5165",r.a.createElement("code",null,"Provider")),r.a.createElement("li",null,"\u4f7f\u7528 Provider \u7ec4\u4ef6\uff0c\u628a store \u4f20\u9012\u7ed9 props.value\uff0c\u5411\u4e0b\u5c42\u7ec4\u4ef6\u4f20\u9012\u8fd9\u4e2a store"))),r.a.createElement("h3",{id:"providerjs"},r.a.createElement(c["AnchorLink"],{to:"#providerjs","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Provider.js"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u5c31\u662f\u4e00\u4e2a\u51fd\u6570\u7ec4\u4ef6\u3002\u63d0\u4f9b\u4e00\u4e2a context\uff0c\u5411\u4e0b\u5c42\u7ec4\u4ef6\u4f20\u9012 store")),r.a.createElement("h3",{id:"contextjs"},r.a.createElement(c["AnchorLink"],{to:"#contextjs","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Context.js"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u4f7f\u7528 createContext \u521b\u5efa\u4e00\u4e2a context")),r.a.createElement("h3",{id:"connectjs"},r.a.createElement(c["AnchorLink"],{to:"#connectjs","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"connect.js"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u521b\u5efa\u5e76\u8fd4\u56de\u4e86\u4e00\u4e2a\u65b0\u7684\u7ec4\u4ef6\u3002\u5f3a\u58ee\u4e86 props \u5c5e\u6027\uff08\u589e\u52a0\u4e86 state \u548c dispatch \u6d3e\u53d1 action \u7684\u51fd\u6570\uff09")),r.a.createElement(o["a"],{code:"function connect(mapStateProps, mapDispatchProps){\n    return function(WrappedComponent){\n        return function(props){\n            const {store} = useContext(Context);\n            const {getState, dispatch, subscribe} = store;\n            const prevState = getState();\n            // \u6839\u636e\u7ec4\u4ef6\u4f20\u8fdb\u6765\u7684 mapStateProps \u83b7\u53d6\u7ec4\u4ef6\u9700\u8981\u7684 state\uff0cprevState \u53d8\u4e86\u624d\u8fdb\u53bb\u6e32\u67d3\uff08useMomo \u51cf\u5c11\u6e32\u67d3\u6b21\u6570\uff09\n            const stateProps = useMemo(()=>mapStateProps(prevState), [prevState]);\n            // \u6839\u636e\u7ec4\u4ef6\u4f20\u8fdb\u6765\u7684 mapStateProps \u521b\u5efa\u4e00\u4e2a\u65b0\u5bf9\u8c61\uff08\u91cc\u9762\u5305\u542b\u4e86\u53ef\u4ee5\u8fdb\u884c\u6d3e\u53d1 action \u7684\u51fd\u6570\uff09\n            const dispatchProps = useMomo(()=>{\n                let dispatchProps;\n                if(typeof mapDispatchProps === 'object'){ // actions \u5bf9\u8c61\n                    dispatchProps = bindActionCreators(mapDispatchProps, dispatch);\n                }else if(typeof maDispatchProps === 'function'){\n                    dispatchProps = mapDispatchProps(dispatch, props);\n                }else{\n                    dispatchProps = {dispatch};\n                }\n            }, [dispatch, props]);\n            // \u501f\u52a9 useEffect \u548c useReducer\uff0c\u6dfb\u52a0\u4e00\u4e2a\u8ba2\u9605\u7684\u56de\u8c03\uff0c\u5f53\u754c\u9762\u8fdb\u884c\u6d3e\u53d1\u65f6\uff0c\u6240\u6709\u8ba2\u9605\u7684\u56de\u8c03\u90fd\u4f1a\u88ab\u8c03\u7528\uff0c\u8fd9\u4e2a\u65f6\u5019\uff0c\u5c31\u4f1a\u4f7f\u754c\u9762\u8fdb\u884c\u91cd\u65b0\u6e32\u67d3\n            const [, forceUpdate] = useReducer(x=>x+1,0);\n            useEffect(()=>subscribe(forceUpdate), [subscribe]); // \u57fa\u672c\u4e0a\u53ea\u4f1a\u8fdb\u53bb\u4e00\u6b21\uff0c\u56e0\u4e3a subscribe \u57fa\u672c\u4e0d\u4f1a\u88ab\u6539\u53d8\n            return <WrappedComponent {...props} {...stateProps} {...dispatchProps} />\n        }\n    }\n}",lang:"js"}),r.a.createElement("h2",{id:"rudex-hooks"},r.a.createElement(c["AnchorLink"],{to:"#rudex-hooks","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Rudex hooks"),r.a.createElement("h3",{id:"usestore"},r.a.createElement(c["AnchorLink"],{to:"#usestore","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"useStore"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u83b7\u53d6 context \u4e2d\u7684 value.store")),r.a.createElement("h3",{id:"usereduxcontext"},r.a.createElement(c["AnchorLink"],{to:"#usereduxcontext","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"useReduxContext"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u83b7\u53d6 context")),r.a.createElement("h3",{id:"usedispatch"},r.a.createElement(c["AnchorLink"],{to:"#usedispatch","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"useDispatch"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u83b7\u53d6 context \u4e2d\u7684 value.store.dispatch")),r.a.createElement("h3",{id:"subscription"},r.a.createElement(c["AnchorLink"],{to:"#subscription","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Subscription"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u8c03\u7528 store \u7684 subscribe \u4e8b\u4ef6\u6dfb\u52a0\u4e00\u4e2a\u5bf9 store \u7684\u72b6\u6001\u53d8\u5316\u76d1\u542c\uff0c\u81ea\u5df1\u7684 notify \u4f5c\u4e3a\u56de\u8c03\u51fd\u6570"),r.a.createElement("p",null,"notify \u53ef\u4ee5\u7528\u4e8e\u901a\u77e5\u81ea\u5df1\uff0c\u72b6\u6001\u66f4\u65b0\u4e86\uff0c\u8fdb\u800c\u901a\u77e5 useSelector \u662f\u65f6\u5019\u9700\u8981\u5f3a\u5236\u5237\u65b0\u754c\u9762\u4e86"),r.a.createElement("p",null,"\u5728 useSelector \u7684\u65f6\u5019\uff0c\u6dfb\u52a0 Subscription \u7684 subscribe \u4e8b\u4ef6")),r.a.createElement("h3",{id:"useselector"},r.a.createElement(c["AnchorLink"],{to:"#useselector","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"useSelector"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u4e00\u4e2a\u9009\u62e9\u5668\uff0c\u4ece\u603b\u7684\u72b6\u6001\u4e2d\u9009\u62e9\u81ea\u5df1\u7ec4\u4ef6\u7684 state")),r.a.createElement(o["a"],{code:"function useSelector(selector){\n    const {store, subscription} = useReduxContext();\n    const selectedState = useSelectorWithStore(\n        selector, equalityFn, store, subscription\n    );\n    return selectedState;\n}\n\nfunction equalityFn = (a, b) => a===b;\n\nfunction useSelectorWithStore(selector, equalityFn, store, subscription){\n    const [, forceRender] = useReducer(s=>s+1,0);\n    let lastSelector = useRef(); // \u4e0a\u4e00\u4e2a\u9009\u62e9\u5668\u51fd\u6570\n    let lastStoreState = useRef(); // \u4e0a\u4e00\u4e2a\u4ed3\u5e93\u72b6\u6001\uff0c\u8001\u4ed3\u5e93\u72b6\u6001\n    let lastSelectedState = useRef(); // \u4e0a\u4e00\u4e2a\u9009\u4e2d\u7684\u72b6\u6001\uff0c\u8001\u72b6\u6001\n    \n    let storeState = store.getStore(); // \u6700\u65b0\u7684\u4ed3\u5e93\u72b6\u6001\n    let selectedState;\n    // \u4ed3\u5e93\u72b6\u6001\u548c\u9009\u62e9\u5668\u662f\u5426\u6539\u53d8\u4e86\uff0c\u5982\u679c\u6709\u4e00\u4e2a\u6539\u53d8\u4e86\uff0c\u5e94\u8be5\u91cd\u65b0\u8ba1\u7b97\u9009\u4e2d\u7684\u72b6\u6001\n    if(selector !== lastSelector.current || storeState !== lastStoreState.current){\n        selectedState = selector(storeState);\n    }else{\n        selectedState = lastSelectedState.current;\n    }\n    \n    // \u5b58\u50a8\u9009\u62e9\u5668\uff0c\u603b\u4ed3\u5e93\u72b6\u6001\uff0c\u9009\u4e2d\u72b6\u6001\n    useLayoutEffect(()=>{\n     \tlastSelector.current = selector;\n        lastStoreState.current = storeState;\n        lastSelectedState.current = selectedState;\n    });\n    \n    useLayoutEffect(()=>{\n        function checkForUpdates(){\n            const newSelectedState = lastSelector.current(store.getState()); // \u4ece\u6700\u65b0\u7684\u603b\u4ed3\u5e93\u72b6\u6001\u4e2d\u8ba1\u7b97\u51fa\u6700\u65b0\u7684\u9009\u4e2d\u72b6\u6001\n            if(equalityFn(newSelectorState, lastSelectedState.current)){\n                return;\n            }\n            lastSelectedState.current = newSelectedState;\n            forceRender();\n        }\n        checkForUpdates(); // \u7b2c\u4e00\u6b21\u89e6\u53d1\n        subscription.subscribe(checkForUpdates); // \u5f53\u603b\u4ed3\u5e93\u72b6\u6001\u53d8\u5316\u65f6\uff0c\u8fd9\u91cc\u7684\u8ba2\u9605\u56de\u8c03\u4f1a\u88ab\u901a\u77e5\u6267\u884c\n    }, [equalityFn, store, subscription])\n}",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(c["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&c["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(s,{demos:n})}},zH6c:function(e,t,n){e.exports=n.p+"static/redux\u6d41\u7a0b\u56fe.106ca920.png"}}]);